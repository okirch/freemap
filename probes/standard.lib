# Standard probes

# Broadcast probes can be used on local networks to discover all IPv6 nodes
broadcast-probe icmp {
	info "Use ICMP echo broadcast to detect all IPv6 addresses on a local network";
	protocol icmp;
}

# Topology probes try to discover the ingress routers of the target network(s)
topo-probe traceroute {
	info "Detect routing path(s) to target networks using traceroute over UDP";
	protocol traceroute;
	packet-proto udp;
}

topo-probe traceroute-tcp {
	info "Detect routing path(s) to target networks using traceroute over TCP";
	protocol traceroute;
	packet-proto tcp;
}

# Host probes check whether a host is reachable at all
host-probe arp {
	info "Check IPv4 host reachability on local network, using ARP requests";
	protocol arp;
	# Must be marked as optional, because the probe does not handle IPv6 targets,
	# and it works on local networks only
	optional true;
}

host-probe icmp {
	info "Check host reachability, using ICMP echo requests";
	protocol "icmp";
	icmp-type "echo";
	ttl 128;
}

host-probe icmp-info {
	info "Check host reachability, using ICMP info requests";
	protocol icmp;
	icmp-type "info";
	ttl 128;
}

host-probe sctp {
	info "Check whether host supports SCTP";
	protocol ipproto;
	ip-proto sctp;
	payload		0x02, 0x00, 0x00, 0x50,		# port 512 -> 80
			0x00, 0x00, 0x00, 0x00,		# verification tag, 0
			0x37, 0x50, 0x53, 0xe1,		# crc32c checksum (hope I got this right)
			0x01, 0x00, 0x00, 0x14,		# chunk type 1, flags=0, len=20
			0x00, 0x00, 0x00, 0x00,		# init tag 0; receiver MUST return ABORT
			0x00, 0x01, 0x00, 0x00, 	# window credit: 64k
			0x00, 0x02, 0x00, 0x02, 	# number of inbound/outbound streams: 2
			0xde, 0xad, 0xbe, 0xef; 	# initial TSN
}

host-probe ipproto-254 {
	info "Check host reachability, using invalid IP protocol";
	protocol ipproto;
	ip-proto 254;
}

# This probe tries to elicit a TCP RST response from the target host.
# Note, this probe doesn't do anything useful if the host you run
# on has firewalling enabled (the response will be discarded).
host-probe tcp-snack {
	info "Check host reachability by eliciting a RST response to a SYNACK packet (port 80)";
	protocol tcp;
	tcp-flags syn, ack;
	tcp-dst-port 80;
}

# Port probes
port-probe udp {
	info "Standard UDP port scan";
	protocol udp;
}

port-probe tcp {
	info "Standard TCP half-open scan";
	protocol tcp;
}

# Scan routines select a set of probes to use
# Right now, all probes in a scan routine are executed more or less simultaneously, but
# in the future, we may want to have some sort of flow control ("if
# probe A succeeds then run probe B, else probe C".... ).
discovery-scan local {
	broadcast-probe icmp;
}

topology-scan default {
	topo-probe traceroute;
}

host-scan local {
	host-probe arp, icmp;
}

host-scan default {
	host-probe icmp;
}

host-scan thorough {
	host-probe arp, icmp, tcp-snack, sctp;
}

port-scan default {
	port-probe tcp, udp;
}

# Presets define a set of probes
preset local {
	info "scan the local network";

	tcp-ports 22, 25, 80, 443;
	udp-ports 53, 111, 2049, 5353;

	discovery-scan local;
	host-scan local;
	port-scan default;
}

preset default {
	info "default scan focusing on a limited set of services";

	tcp-ports 1-20, 21, 22, 25, 53, 80, 137, 138, 139, 443;
	udp-ports 53, 111, 2049, 5353, 137, 138, 139;

	topology-scan default;
	host-scan default;
	port-scan default;
}

preset thorough {
	info "scan a wider range of services";

	tcp-ports 1-512, 2049, 8080;
	udp-ports 1-512, 2049, 5353;

	topology-scan default;
	host-scan thorough;
	port-scan default;
}

service-catalog "default" {
	use	dns,
		"sunrpc.rpcbind",
		"sunrpc.nfsd";
}
