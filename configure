#!/bin/bash

inst_prefix="/usr/local"
etcdir=""
libdir=""
bindir=""
sharedir=""
opt_development="#undef"

set -- $(getopt -u -n configure -l prefix: -l etcdir: -l bindir: -l libdir: -l sharedir: -l development -- "" "$@")

while [ $# -gt 0 -a "$1" != "--" ]; do
	case $1 in
	"--prefix")
		inst_prefix=$2; shift;;
	"--etcdir")
		etcdir=$2; shift;;
	"--bindir")
		bindir=$2; shift;;
	"--libdir")
		libdir=$2; shift;;
	"--sharedir")
		sharedir=$2; shift;;
	"--development")
		opt_development="#define";;
	esac

	shift
done

if [ -z "$etcdir" ]; then
	etcdir="$inst_prefix/etc"
fi

if [ -z "$bindir" ]; then
	bindir="$inst_prefix/bin"
fi

if [ -z "$libdir" ]; then
	libdir="$inst_prefix/lib"
fi

if [ -z "$sharedir" ]; then
	sharedir="$inst_prefix/share"
fi

echo "Writing xconfig.h"
cat > lib/xconfig.h <<EOF
/* Generated by configure, do not edit */

#define FREEMAP_ETC_PATH	"$etcdir"
#define FREEMAP_SHARE_PATH	"$sharedir"
#define FREEMAP_PROBES_PATH	FREEMAP_SHARE_PATH "/freemap/probes"
$opt_development FREEMAP_DEVELOPMENT

EOF

echo "Writing Makefile.inc"
cat > Makefile.inc <<EOF
# Generated by configure, do not edit

INSTALL_ETCDIR		= \$(DESTROOT)$etcdir
INSTALL_BINDIR		= \$(DESTROOT)$bindir
INSTALL_LIBDIR		= \$(DESTROOT)$bindir
INSTALL_SHAREDIR	= \$(DESTROOT)$sharedir
INSTALL_PROBESDIR	= \$(DESTROOT)$sharedir/freemap/probes

EOF
